<!-- 
프로젝트 : 사출기 통합 현황 풀프루프
시작일자 : 2023-04-07
제작자 : 임혜빈
코멘트 :
controll1 테이블 사용
기존 테이블에서 id를 20개로 늘림 (id = 1 을 1~19까지 사용하는 방법도 있지만 동시에 호기가 사출할 경우 데이터 소실됨)
-->
<?php
session_start();
$conn = new mysqli("localhost", "server", "00000000", "dataset");
if ($_SESSION['theme'] != null) {
    $_SESSION['theme'] = $_SESSION['theme'];
} else {
    $_SESSION['theme'] = "1";
};
?>
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- <meta http-equiv="refresh" content="0.5; url=/action/foolproof_call.html" /> -->
    <title>Document</title>
</head>

<body>

    <?php
    //세션이 바뀌면 id 값이 바뀌므로 세션 이용하지 않고 고정숫자로 사용

    //call1 값 조회
    echo $sql = "select * from controll1 where id='2'";
    $res = mysqli_query($conn, $sql);
    $row = mysqli_fetch_array($res);

    //call1이 1일때 부모창 새로고침
    if ($row['call1'] == '1') {
        echo "
            <script>
            window.parent.location.reload();
            window.parent.location.href='/page/foolproof.html?num=2';
            </script>
            ";

        // 0으로 되돌리기
        $sql = "update controll1 set call1 = '0' where id='2'";
        $res = mysqli_query($conn, $sql);
        $row = mysqli_fetch_array($res);
    }
    ?>
    <script>
        function timeRefresh(timeoutPeriod) {
            setTimeout("location.reload(true);", timeoutPeriod);
        }

        window.onload = timeRefresh(100);
    </script>
</body>

</html>